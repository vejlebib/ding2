<?php

/**
 * @file
 * Ding SEO module file.
 */

/**
 * Implements hook_metatag_get_entity_metatags_instance_alter().
 *
 * Note: appearently this hook has to reside in module file and can not be in
 * ding_seo.metatag.inc. or else it will ONLY be called on first page load
 * after a cache clear. Investigate why this happens?
 */
function ding_seo_metatag_get_entity_metatags_instance_alter(&$instance, $entity, $entity_type, $bundle) {
  if ($entity_type == 'ting_object') {
    // Use simple material type checking for now to decide a ting objects schema
    // type. We will have to get more complex in the future, when we have to
    // distinguish between movies and tv-series for example. Also if we wish to
    // be provider independant we need a mechanism to avoid hard coded values.
    // For now this is opensearch speficic anb based and DKABM types:
    // http://www.danbib.dk/docs/abm/types.xml
    $material_type = drupal_strtolower($entity->getType());

    $test = field_info_instance('ting_object', 'ting_cover', 'ting_object');

    $schema_type_mapping = [
      'book' => [
        'bog',
        'bog stor skrift',
        'billedbog',
        'ebog',
        'lydbog (bånd)',
        'lydbog (cd)',
        'lydbog (net)',
        'lydbog (cd-mp3)',
        'årbog',
      ],
      'movie' => [
        'dvd',
        'dvd (film)',
        'blu-ray',
        'film',
        'film (net)',
      ]
    ];

    foreach ($schema_type_mapping as $schema_type => $material_types) {
      if (in_array($material_type, $material_types)) {
        $instance = 'ting_object:' . $schema_type;
        return;
      }
    }
  }
}
